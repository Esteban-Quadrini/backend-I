<div class="card">
  <h2>{{product.title}}</h2>
  <p>{{product.description}}</p>
  <p><strong>Precio:</strong> ${{product.price}}</p>
  <p><strong>Categoria:</strong> {{product.category}}</p>
  <p><strong>Stock:</strong> {{product.stock}}</p>
  <button id="addToCart" class="btn">Agregar al carrito</button>
</div>

<script>
  document.getElementById('addToCart').addEventListener('click', async () => {
    const pid = '{{product._id}}';
    let cid = localStorage.getItem('cartId');
    if (!cid) {
      const res = await fetch('/api/carts', { method: 'POST' });
      const data = await res.json();
      cid = data.payload._id || data.payload.id;
      localStorage.setItem('cartId', cid);
    }
    const res = await fetch(`/api/carts/${cid}/product/${pid}`, { method: 'POST' });
    if (res.ok) alert('Agregado al carrito');
    else alert('Error');
  });
</script>